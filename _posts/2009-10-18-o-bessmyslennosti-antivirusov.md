---
id: 1083
title: О бессмысленности антивирусов
date: 2009-10-18T18:10:00+00:00
author: sapran
layout: post
guid: http://styran.com/2009/10/18/%d0%be-%d0%b1%d0%b5%d1%81%d1%81%d0%bc%d1%8b%d1%81%d0%bb%d0%b5%d0%bd%d0%bd%d0%be%d1%81%d1%82%d0%b8-%d0%b0%d0%bd%d1%82%d0%b8%d0%b2%d0%b8%d1%80%d1%83%d1%81%d0%be%d0%b2/
permalink: /2009/10/%d0%be-%d0%b1%d0%b5%d1%81%d1%81%d0%bc%d1%8b%d1%81%d0%bb%d0%b5%d0%bd%d0%bd%d0%be%d1%81%d1%82%d0%b8-%d0%b0%d0%bd%d1%82%d0%b8%d0%b2%d0%b8%d1%80%d1%83%d1%81%d0%be%d0%b2/
blogger_blog:
  - securegalaxy.blogspot.com
blogger_author:
  - Vlad Styran
blogger_permalink:
  - /2009/10/blog-post_18.html
blogger_internal:
  - /feeds/3388835630659782197/posts/default/3189616821505469833
shorturl:
  - http://tinyurl.com/nlb8wc6
tags:
  - metasploit
  - антивирусы
  - зловредный код
---
<span style="font-family: Arial; font-size: small;"><span style="background-color: white; font-size: 13px;"><span style="font-family: 'Sans Serif';"><span style="font-size: medium;"><span style="font-family: Arial; font-size: small;"><span style="background-color: white; font-size: 13px;">Антивирусы (вернее вера в то, что они способны защитить от вирусов)&nbsp;&#8212; одно из наиболее распространенных заблуждений человечества.</span></span></span></span></span></span>  
<span style="font-family: Arial; font-size: small;"><span style="background-color: white; font-size: 13px;"><span style="font-family: 'Sans Serif';"><span style="font-size: medium;"><span style="font-family: Arial; font-size: small;"><span style="background-color: white; font-size: 13px;"><br /></span></span></span></span></span></span>  
<span style="font-family: Arial; font-size: small;"><span style="background-color: white; font-size: 13px;"><span style="font-family: 'Sans Serif';"><span style="font-size: medium;"><span style="font-family: Arial; font-size: small;"><span style="background-color: white; font-size: 13px;">Начнем с азов. Кибер-атаки, в т.ч. и вирусные, делятся на два основных класса: (<b>1) оппортунистические</b> и (<b>2) целенаправленные</b>. Оппортунистический подход, это когда хакер выпускает на свободу вирус, в надежде, что он попадет на компьютер,&nbsp;на котором по каким-то причинам не установлены последние обновления ПО. Таких компьютеров большинство, поэтому шансы хакера велики. С другой стороны, если на компе установлены все патчи, а за клавиатурой сидит пользователь с минимальными зачатками интеллекта, то шансы моментально сокращаются. Или же пусть хакер пытается вломиться на веб-сервер. Просканировав его при помощи сканера уязвимостей, он обнаруживает, что очевидных дыр в&nbsp;безопасности&nbsp;сервера нет, и решает не напрягаться и поискать цель по-проще. Это тоже пример оппортунистической атаки.</span></span></span></span></span></span>  
<span style="font-family: Arial; font-size: small;"><span style="background-color: white; font-size: 13px;"><span style="font-family: 'Sans Serif';"><span style="font-size: medium;"><span style="font-family: Arial; font-size: small;"><span style="background-color: white; font-size: 13px;"><br /></span></span></span></span></span></span>  
<span style="font-family: Arial; font-size: small;"><span style="background-color: white; font-size: 13px;"><span style="font-family: 'Sans Serif';"><span style="font-size: medium;"><span style="font-family: Arial; font-size: small;"><span style="background-color: white; font-size: 13px;">Во время&nbsp;целенаправленной&nbsp;атаки хакер не отступает и не переключается на более доступную цель, а делает все от него&nbsp;зависящее&nbsp;для&nbsp;осуществления&nbsp;успешного взлома. Как правило, подобные атаки&nbsp;происходят не случайно и&nbsp;хорошо финансируются. Не мудрено, кибер-пространство с каждым днем криминализируется все больше и больше, а прибыль от кибер-преступности&nbsp;в этом году&nbsp;превысила&nbsp;мировой доход от наркоторговли.</span></span></span></span></span></span>  
<span style="font-family: Arial; font-size: small;"><span style="background-color: white; font-size: 13px;"><span style="font-family: 'Sans Serif';"><span style="font-size: medium;"><span style="font-family: Arial; font-size: small;"><span style="background-color: white; font-size: 13px;"><br /></span></span></span></span></span></span>  
<span style="font-family: Arial; font-size: small;"><span style="background-color: white; font-size: 13px;"><span style="font-family: 'Sans Serif';"><span style="font-size: medium;"><span style="font-family: Arial; font-size: small;"><span style="background-color: white; font-size: 13px;">Так вот, антивирус способен &#171;поймать&#187; только оппортунистический вирус. Все антивирусы работают по принципу обнаружения т.н. сигнатур &#8212; участков кода известных вирусов. Коллекции таких сигнатур называются антивирусными базами данных. Помимо обнаружения по сигнатурам,&nbsp;существует&nbsp;также техника эвристического анализа, но этот подход требователен к ресурсам и все еще находится в зачаточном состоянии, посему не эффективен. Вот и выходит, что если очень захотеть, то можно имеющийся вирус модифицировать таким образом, что ни один антивирус его не обнаружит. Не верите? Я тоже сомневался, пока сам не попробовал.</span></span></span></span></span></span>  
<span style="font-family: Arial; font-size: small;"><span style="background-color: white; font-size: 13px;"><span style="font-family: 'Sans Serif';"><span style="font-size: medium;"><span style="font-family: Arial; font-size: small;"><span style="background-color: white; font-size: 13px;"><br /></span></span></span></span></span></span>  
<a href="http://www.metasploit.com/images/hax_small.jpg" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="143" src="http://www.metasploit.com/images/hax_small.jpg" width="200" /></a><span style="font-family: Arial; font-size: small;"><span style="background-color: white; font-size: 13px;"><span style="font-family: 'Sans Serif';"><span style="font-size: medium;"><span style="font-family: Arial; font-size: small;"><span style="background-color: white; font-size: 13px;">Я знаком с двумя инструментами, способными изменить вредоносный код до неузнаваемости антивирусами. Первый &#8212; это <b>PEscrambler </b>Ника Харбора, второй &#8212; <b>msfencode</b>, входящий в состав <a href="http://www.metasploit.com/">Metasploit Framework</a>. Msfencode вроде бы более эффективен, но не всегда есть под рукой. Зато PEscrambler &#8212; это обычный ехе-шник, всегда доступный для скачивания на <a href="http://www.rnicrosoft.net/">сайте автора</a>. Если кому-то захочется проверить эффективность их работы &#8212; милости прошу. Для теста можно использовать что-то не очень опасное, но единогласно обнаруживаемое антивирусами как вредоносный код. Например, <a href="http://oss.coresecurity.com/projects/pshtoolkit.htm">iam.exe</a>, <a href="http://www.foofus.net/fizzgig/pwdump/">pwdump6.exe</a>, а еще лучше &#8212; форматированный <a href="http://en.wikipedia.org/wiki/Payload_(software)">payload</a>, полученный средствами того-же MSF (подробнее читайте в <a href="http://www.offensive-security.com/metasploit-unleashed/Antivirus-Bypass">этом разделе</a>&nbsp;соответствующего&nbsp;курса молодого бойца). В ходе опытов, после нескольких загрузок результирующего кода на <a href="http://virustotal.com/">virustotal.com</a>, становится очевидно, что обмануть все антивирусы одним махом вряд ли удастся. А вот &#171;заточить&#187; код так, чтобы&nbsp;отдельно&nbsp;взятый антивирус его не узнал &#8212; вполне возможно. Улавливаете параллель с&nbsp;оппортунистическими&nbsp;и целенаправленными атаками? От первых защититься не сложно, от последних &#8212; почти невозможно.</span></span></span></span></span></span>  
<span style="font-family: Arial; font-size: small;"><span style="background-color: white; font-size: 13px;"><span style="font-family: 'Sans Serif';"><span style="font-size: medium;"><span style="font-family: Arial; font-size: small;"><span style="background-color: white; font-size: 13px;"><br /></span></span></span></span></span></span>  
<span style="font-family: Arial; font-size: small;"><span style="background-color: white; font-size: 13px;"><span style="font-family: 'Sans Serif';"><span style="font-size: medium;"><span style="font-family: Arial; font-size: small;"><span style="background-color: white; font-size: 13px;">И пару слов &#171;от себя&#187;. Лично у меня уже лет пять антивирус срабатывает только тогда, когда я сам пытаюсь разместить на компьютере нечто похожее не вирус. Вспоминается диалог аудитора с сотрудником компании, специализирующейся на исследовании вирусов.</span></span></span></span></span></span>  
<span style="font-family: Arial; font-size: small;"><span style="font-size: 13px;">&#8212; У вас на ПК антивирусы есть?&nbsp;</span></span>  
<span style="font-family: Arial; font-size: small;"><span style="font-size: 13px;">&#8212; Нет.</span></span>  
<span style="font-family: Arial; font-size: small;"><span style="font-size: 13px;">&#8212; Нет?? Значит полно вирусов?</span></span>  
<span style="font-family: Arial; font-size: small;"><span style="font-size: 13px;">&#8212; Ну у меня лично гигов 12 где-то.</span></span>  
<span style="font-family: Arial; font-size: small;"><span style="font-size: 13px;">Я знаком с людьми, совершенно не пользующимися АВ. Ну не качает мужик игры с торрентов, не ищет кряки в Интернете и не лазает по порносайтам.</span></span>

<div class="addtoany_share_save_container addtoany_content_bottom">
  <div class="a2a_kit a2a_kit_size_32 addtoany_list a2a_target" id="wpa2a_58">
    <a class="a2a_button_facebook" href="http://www.addtoany.com/add_to/facebook?linkurl=https%3A%2F%2Fblog.styran.com%2F2009%2F10%2F%25d0%25be-%25d0%25b1%25d0%25b5%25d1%2581%25d1%2581%25d0%25bc%25d1%258b%25d1%2581%25d0%25bb%25d0%25b5%25d0%25bd%25d0%25bd%25d0%25be%25d1%2581%25d1%2582%25d0%25b8-%25d0%25b0%25d0%25bd%25d1%2582%25d0%25b8%25d0%25b2%25d0%25b8%25d1%2580%25d1%2583%25d1%2581%25d0%25be%25d0%25b2%2F&linkname=%D0%9E%20%D0%B1%D0%B5%D1%81%D1%81%D0%BC%D1%8B%D1%81%D0%BB%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8%20%D0%B0%D0%BD%D1%82%D0%B8%D0%B2%D0%B8%D1%80%D1%83%D1%81%D0%BE%D0%B2" title="Facebook" rel="nofollow" target="_blank"></a><a class="a2a_button_twitter" href="http://www.addtoany.com/add_to/twitter?linkurl=https%3A%2F%2Fblog.styran.com%2F2009%2F10%2F%25d0%25be-%25d0%25b1%25d0%25b5%25d1%2581%25d1%2581%25d0%25bc%25d1%258b%25d1%2581%25d0%25bb%25d0%25b5%25d0%25bd%25d0%25bd%25d0%25be%25d1%2581%25d1%2582%25d0%25b8-%25d0%25b0%25d0%25bd%25d1%2582%25d0%25b8%25d0%25b2%25d0%25b8%25d1%2580%25d1%2583%25d1%2581%25d0%25be%25d0%25b2%2F&linkname=%D0%9E%20%D0%B1%D0%B5%D1%81%D1%81%D0%BC%D1%8B%D1%81%D0%BB%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8%20%D0%B0%D0%BD%D1%82%D0%B8%D0%B2%D0%B8%D1%80%D1%83%D1%81%D0%BE%D0%B2" title="Twitter" rel="nofollow" target="_blank"></a><a class="a2a_button_google_plus" href="http://www.addtoany.com/add_to/google_plus?linkurl=https%3A%2F%2Fblog.styran.com%2F2009%2F10%2F%25d0%25be-%25d0%25b1%25d0%25b5%25d1%2581%25d1%2581%25d0%25bc%25d1%258b%25d1%2581%25d0%25bb%25d0%25b5%25d0%25bd%25d0%25bd%25d0%25be%25d1%2581%25d1%2582%25d0%25b8-%25d0%25b0%25d0%25bd%25d1%2582%25d0%25b8%25d0%25b2%25d0%25b8%25d1%2580%25d1%2583%25d1%2581%25d0%25be%25d0%25b2%2F&linkname=%D0%9E%20%D0%B1%D0%B5%D1%81%D1%81%D0%BC%D1%8B%D1%81%D0%BB%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8%20%D0%B0%D0%BD%D1%82%D0%B8%D0%B2%D0%B8%D1%80%D1%83%D1%81%D0%BE%D0%B2" title="Google+" rel="nofollow" target="_blank"></a><a class="a2a_button_linkedin" href="http://www.addtoany.com/add_to/linkedin?linkurl=https%3A%2F%2Fblog.styran.com%2F2009%2F10%2F%25d0%25be-%25d0%25b1%25d0%25b5%25d1%2581%25d1%2581%25d0%25bc%25d1%258b%25d1%2581%25d0%25bb%25d0%25b5%25d0%25bd%25d0%25bd%25d0%25be%25d1%2581%25d1%2582%25d0%25b8-%25d0%25b0%25d0%25bd%25d1%2582%25d0%25b8%25d0%25b2%25d0%25b8%25d1%2580%25d1%2583%25d1%2581%25d0%25be%25d0%25b2%2F&linkname=%D0%9E%20%D0%B1%D0%B5%D1%81%D1%81%D0%BC%D1%8B%D1%81%D0%BB%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8%20%D0%B0%D0%BD%D1%82%D0%B8%D0%B2%D0%B8%D1%80%D1%83%D1%81%D0%BE%D0%B2" title="LinkedIn" rel="nofollow" target="_blank"></a><a class="a2a_dd addtoany_share_save" href="https://www.addtoany.com/share"></a>
  </div>
</div>
